<%- include('../partials/header', { title: 'Llistat d\'actuacions' }) %>

<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="display-6 fw-bold">📝 Llistat d’actuacions</h1>
    <a href="/incidencies" class="btn btn-outline-secondary">← Tornar a incidències</a>
  </div>

  <div id="main-content" class="container mt-3">
    <div class="text-center mb-5">
      <a class="btn btn-lg btn-primary mt-3 shadow" href="/actuacions/new">➕ Afegir Actuació</a>
    </div>

    <form class="mb-4" onsubmit="event.preventDefault();">
      <label for="searchId" class="form-label fw-semibold">Filtrar per ID d'incidència:</label>
      <input type="number" id="searchId" class="form-control" placeholder="Filtra por número de ID" oninput="filterByIncidenciaId()">
    </form>

  <div class="card shadow-sm rounded-4 border-0">
    <div class="card-body">
      <table class="table align-middle table-hover">
        <thead class="table-light">
          <tr class="text-uppercase text-muted small">
            <th>ID</th>
            <th>Descripció</th>
            <th>Temps (min)</th>
            <th class="text-center">Accions</th>
          </tr>
        </thead>
        <tbody>
          <% actuacions.forEach(actuacio => { %>
            <tr data-incidencia-id="<%= actuacio.id_incidencia %>">
              <td class="fw-semibold"><%= actuacio.id %></td>
              <td><%= actuacio.descripcio_actuacio %></td>
              <td><%= actuacio.temps %></td>
              <td class="text-center">
                <a href="/actuacions/<%= actuacio.id %>/edit" class="btn btn-sm btn-outline-warning me-1">
                  ✏️ Editar
                </a>
                <form action="/actuacions/<%= actuacio.id %>/delete" method="POST" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Segur que vols eliminar aquesta actuació?')">
                    🗑️ Eliminar
                  </button>
                </form>  
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>


<script>
  function filterByIncidenciaId() {
    const input = document.getElementById("searchId").value.trim();
    const rows = document.querySelectorAll("tbody tr");

    rows.forEach(row => {
      const incidenciaId = row.dataset.incidenciaId;
      if (!input || incidenciaId === input) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }
</script>

<%- include('../partials/footer') %>
