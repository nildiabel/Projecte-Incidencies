<!-- header.ejs -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title><%= title %></title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    crossorigin="anonymous"
  />
</head>
<body class="bg-light">

  <!-- Barra de navegación -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
      <a class="navbar-brand" href="/" id="projecte-link">Projecte Incidencies</a>
      <div>
        <ul class="navbar-nav me-auto">

          <!-- Modificado el enlace para que active el formulario de contraseña -->
          <li class="nav-item">
            <a class="nav-link" href="javascript:void(0)" id="incidencies-link" onclick="showPasswordPrompt()">Incidencies (EJS)</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Contenedor para mostrar el formulario de contraseña (oculto inicialmente) -->
  <div id="password-prompt" class="container mt-5" style="display: none;">
    <div class="row justify-content-center">
      <div class="col-12 col-md-6">
        <div class="card p-4 shadow-lg">
          <div class="input-group mb-3">
            <span class="input-group-text">Contraseña</span>
            <input type="password" id="password" class="form-control" placeholder="Introduce la contraseña">
          </div>
          <button class="btn btn-success mb-3 w-100" onclick="checkPassword()">Acceder</button>
          <p id="error-message" class="text-danger mt-2" style="display: none;">Contraseña incorrecta, intenta de nuevo.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const correctPassword = "12345";

    // Verificar si ya se ha validado la contraseña
    if (sessionStorage.getItem("accessGranted") === "true") {
      document.getElementById("incidencies-link").style.pointerEvents = "none";
      document.getElementById("projecte-link").style.pointerEvents = "none"; // Desactivar el enlace
    }

    function showPasswordPrompt() {
      document.getElementById("password-prompt").style.display = "block";
      document.getElementById("main-content").style.display = "none";
      document.getElementById("incidencies-link").style.pointerEvents = "none";
      document.getElementById("projecte-link").style.pointerEvents = "none"; // Desactivar el enlace
    }

    function checkPassword() {
      const enteredPassword = document.getElementById("password").value;
      if (enteredPassword === correctPassword) {
        sessionStorage.setItem("accessGranted", "true"); // Guardar en sessionStorage que el acceso fue concedido
        window.location.href = "/incidencies";
      } else {
        document.getElementById("error-message").style.display = "block";
      }
    }
  </script>
</body>
</html>
